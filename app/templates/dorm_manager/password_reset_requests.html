{% extends 'dorm_manager/base.html' %}

{% block title %}密码重置申请 - 宿管后台{% endblock %}
{% block header %}密码重置申请{% endblock %}

{% block content %}
<div class="card">
    <h2>密码重置申请</h2>
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>用户名</th>
                    <th>学生姓名</th>
                    <th>宿舍</th>
                    <th>申请时间</th>
                    <th>状态</th>
                    <th>操作</th>
                </tr>
            </thead>
            <tbody>
                {% if requests %}
                    {% for req in requests %}
                    <tr>
                        <td>{{ req.user.username }}</td>
                        <td>{{ req.user.student.name if req.user.student else '-' }}</td>
                        <td>{{ req.user.student.dormitory.dorm_number if req.user.student and req.user.student.dormitory else '-' }}</td>
                        <td>{{ req.request_time.strftime('%Y-%m-%d %H:%M') }}</td>
                        <td>
                            {% if req.status == 'pending' %}
                                <span style="color: orange;">待处理</span>
                            {% elif req.status == 'completed' %}
                                <span style="color: green;">已完成</span>
                            {% elif req.status == 'rejected' %}
                                <span style="color: red;">已拒绝</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if req.status == 'pending' %}
                                <a href="{{ url_for('dorm_manager.handle_password_reset', req_id=req.id, action='approve') }}" class="btn btn-success" style="padding: 5px 10px; font-size: 12px;" onclick="return confirm('确认重置密码并发送邮件？')">发送密码</a>
                                <a href="{{ url_for('dorm_manager.handle_password_reset', req_id=req.id, action='reject') }}" class="btn btn-danger" style="padding: 5px 10px; font-size: 12px;" onclick="return confirm('确认拒绝申请？')">拒绝</a>
                            {% else %}
                                <span>-</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                {% else %}
                    <tr><td colspan="6" style="text-align: center;">暂无申请记录</td></tr>
                {% endif %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
